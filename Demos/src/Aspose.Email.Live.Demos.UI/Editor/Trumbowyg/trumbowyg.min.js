/**
 * Trumbowyg v2.18.0 - A lightweight WYSIWYG editor
 * Trumbowyg core file
 * ------------------------
 * @link http://alex-d.github.io/Trumbowyg
 * @license MIT
 * @author Alexandre Demode (Alex-D)
 *         Twitter : @AlexandreDemode
 *         Website : alex-d.fr
 * 02/07/2019 by Dmitry Zotov
 */
var THROTTLE_TIMEOUT=5e3,throttler=null,gaEvent=function(n,t){var i,r;if(t||(t="Editor Navbar"),i="ga"in window.parent?window.parent.ga:"ga"in window?window.ga:null,i!==null)try{r=i.getAll()[0];r!==undefined&&r.send("event",{eventCategory:t,eventAction:n})}catch(u){}};jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",undo:"Undo",redo:"Redo",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",superscript:"Superscript",subscript:"Subscript",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",link:"Link",createLink:"Insert link",unlink:"Remove link",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"Fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target",width:"Width"}},plugins:{},svgPath:null,hideButtonTexts:null};Object.defineProperty(jQuery.trumbowyg,"defaultOptions",{value:{lang:"en",fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,autogrowOnEnter:!1,imageWidthModalEdit:!1,prefix:"trumbowyg-",semantic:!0,semanticKeepAttributes:!1,resetCss:!1,removeformatPasted:!1,tabToIndent:!1,tagsToRemove:[],tagsToKeep:["hr","img","embed","iframe","input"],btns:[["viewHTML"],["undo","redo"],["formatting"],["strong","em","del"],["superscript","subscript"],["link"],["insertImage"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat"],["fullscreen"]],btnsDef:{},changeActiveDropdownIcon:!1,inlineElementsSelector:"a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u",pasteHandlers:[],plugins:{},urlProtocol:!1,minimalLinks:!1},writable:!1,enumerable:!0,configurable:!1}),function(n,t,i,r){"use strict";var u="tbwconfirm",f="tbwcancel",e;r.fn.trumbowyg=function(n,t){var u="trumbowyg",i;if(n===Object(n)||!n)return this.each(function(){r(this).data(u)||r(this).data(u,new e(this,n))});if(this.length===1)try{i=r(this).data(u);switch(n){case"execCmd":return i.execCmd(t.cmd,t.param,t.forceCss);case"openModal":return i.openModal(t.title,t.content);case"closeModal":return i.closeModal();case"openModalInsert":return i.openModalInsert(t.title,t.fields,t.callback);case"saveRange":return i.saveRange();case"getRange":return i.range;case"getRangeText":return i.getRangeText();case"restoreRange":return i.restoreRange();case"enable":return i.setDisabled(!1);case"disable":return i.setDisabled(!0);case"toggle":return i.toggle();case"destroy":return i.destroy();case"empty":return i.empty();case"html":return i.html(t)}}catch(f){}return!1};e=function(u,f){var e=this,w="trumbowyg-icons",o=r.trumbowyg,s,v,c,l,y,a,h,p;if(e.doc=u.ownerDocument||i,e.$ta=r(u),e.$c=r(u),f=f||{},e.lang=f.lang!=null||o.langs[f.lang]!=null?r.extend(!0,{},o.langs.en,o.langs[f.lang]):o.langs.en,e.hideButtonTexts=o.hideButtonTexts!=null?o.hideButtonTexts:f.hideButtonTexts,s=o.svgPath!=null?o.svgPath:f.svgPath,e.hasSvg=s!==!1,e.svgPath=!e.doc.querySelector("base")?"":t.location.href.split("#")[0],r("#"+w,e.doc).length===0&&s!==!1){if(s==null){for(v=i.getElementsByTagName("script"),c=0;c<v.length;c+=1)l=v[c].src,y=l.match("trumbowyg(.min)?.js"),y!=null&&(s=l.substring(0,l.indexOf(y[0]))+"ui/icons.svg");s==null&&console.warn("You must define svgPath: https://goo.gl/CfTY9U")}a=e.doc.createElement("div");a.id=w;e.doc.body.insertBefore(a,e.doc.body.childNodes[0]);r.ajax({async:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"xml",crossDomain:!0,url:s,data:null,beforeSend:null,complete:null,success:function(n){a.innerHTML=(new XMLSerializer).serializeToString(n.documentElement)}})}h=e.lang.header;p=function(){return(t.chrome||t.Intl&&Intl.v8BreakIterator)&&"CSS"in t};e.btnsDef={viewHTML:{fn:"toggle","class":"trumbowyg-not-disable"},undo:{isSupported:p,key:"Z"},redo:{isSupported:p,key:"Y"},p:{fn:"formatBlock"},blockquote:{fn:"formatBlock"},h1:{fn:"formatBlock",title:h+" 1"},h2:{fn:"formatBlock",title:h+" 2"},h3:{fn:"formatBlock",title:h+" 3"},h4:{fn:"formatBlock",title:h+" 4"},h5:{fn:"formatBlock",title:h+" 5"},h6:{fn:"formatBlock",title:h+" 6"},subscript:{tag:"sub"},superscript:{tag:"sup"},bold:{key:"B",tag:"b"},italic:{key:"I",tag:"i"},underline:{tag:"u"},strikethrough:{tag:"strike"},strong:{fn:"bold",key:"B"},em:{fn:"italic",key:"I"},del:{fn:"strikethrough"},createLink:{key:"K",tag:"a"},unlink:{},insertImage:{},justifyLeft:{tag:"left",forceCss:!0},justifyCenter:{tag:"center",forceCss:!0},justifyRight:{tag:"right",forceCss:!0},justifyFull:{tag:"justify",forceCss:!0},unorderedList:{fn:"insertUnorderedList",tag:"ul"},orderedList:{fn:"insertOrderedList",tag:"ol"},horizontalRule:{fn:"insertHorizontalRule"},removeformat:{},fullscreen:{"class":"trumbowyg-not-disable"},close:{fn:"destroy","class":"trumbowyg-not-disable"},formatting:{dropdown:["p","blockquote","h1","h2","h3","h4"],ico:"p"},link:{dropdown:["createLink","unlink"]}};e.o=r.extend(!0,{},o.defaultOptions,f);e.o.hasOwnProperty("imgDblClickHandler")||(e.o.imgDblClickHandler=e.getDefaultImgDblClickHandler());e.urlPrefix=e.setupUrlPrefix();e.disabled=e.o.disabled||u.nodeName==="TEXTAREA"&&u.disabled;f.btns?e.o.btns=f.btns:e.o.semantic||(e.o.btns[3]=["bold","italic","underline","strikethrough"]);r.each(e.o.btnsDef,function(n,t){e.addBtnDef(n,t)});e.eventNamespace="trumbowyg-event";e.keys=[];e.tagToButton={};e.tagHandlers=[];e.pasteHandlers=[].concat(e.o.pasteHandlers);e.isIE=n.userAgent.indexOf("MSIE")!==-1||n.appVersion.indexOf("Trident/")!==-1;e.isMac=n.platform.toUpperCase().indexOf("MAC")!==-1;e.init()};e.prototype={DEFAULT_SEMANTIC_MAP:{b:"strong",i:"em",s:"del",strike:"del",div:"p"},init:function(){var n=this;n.height=n.$ta.height();n.initPlugins();try{n.doc.execCommand("enableObjectResizing",!1,!1);n.doc.execCommand("defaultParagraphSeparator",!1,"p")}catch(t){}n.buildEditor();n.buildBtnPane();n.fixedBtnPaneEvents();n.buildOverlay();setTimeout(function(){n.disabled&&n.setDisabled(!0);n.$c.trigger("tbwinit")})},addBtnDef:function(n,t){this.btnsDef[n]=r.extend(t,this.btnsDef[n]||{})},setupUrlPrefix:function(){var n=this.o.urlProtocol;if(n)return typeof n!="string"?"https://":n.replace("://","")+"://"},buildEditor:function(){var n=this,i=n.o.prefix,u="";n.$box=r("<div/>",{"class":i+"box "+i+"editor-visible "+i+n.o.lang+" trumbowyg"});n.isTextarea=n.$ta.is("textarea");n.isTextarea?(u=n.$ta.val(),n.$ed=r("<div/>"),n.$box.insertAfter(n.$ta).append(n.$ed,n.$ta)):(n.$ed=n.$ta,u=n.$ed.html(),n.$ta=r("<textarea/>",{name:n.$ta.attr("id"),height:n.height}).val(u),n.$box.insertAfter(n.$ed).append(n.$ta,n.$ed),n.syncCode());n.$ta.addClass(i+"textarea").attr("tabindex",-1);n.$ed.addClass(i+"editor").attr({contenteditable:!0,dir:n.lang._dir||"ltr"}).html(u);n.o.tabindex&&n.$ed.attr("tabindex",n.o.tabindex);n.$c.is("[placeholder]")&&n.$ed.attr("placeholder",n.$c.attr("placeholder"));n.$c.is("[spellcheck]")&&n.$ed.attr("spellcheck",n.$c.attr("spellcheck"));n.o.resetCss&&n.$ed.addClass(i+"reset-css");n.o.autogrow||n.$ta.add(n.$ed).css({height:n.height});n.semanticCode();n.o.autogrowOnEnter&&n.$ed.addClass(i+"autogrow-on-enter");var f=!1,e=!1,o;n.$ed.on("dblclick","img",n.o.imgDblClickHandler).on("keydown",function(t){if((t.ctrlKey||t.metaKey)&&!t.altKey){f=!0;var i=n.keys[String.fromCharCode(t.which).toUpperCase()];try{return n.execCmd(i.fn,i.param),!1}catch(r){}}else if(n.o.tabToIndent&&t.key==="Tab")try{return t.shiftKey?n.execCmd("outdent",!0,null):n.execCmd("indent",!0,null),!1}catch(r){}}).on("compositionstart compositionupdate",function(){e=!0}).on("keyup compositionend",function(t){var i,r;if(t.type==="compositionend")e=!1;else if(e)return;(i=t.which,i>=37&&i<=40)||((t.ctrlKey||t.metaKey)&&(i===89||i===90)?(n.semanticCode(!1,!0),n.$c.trigger("tbwchange")):f||i===17?typeof t.which=="undefined"&&n.semanticCode(!1,!1,!0):(r=n.isIE?t.type==="compositionend":!0,n.$c.trigger("tbwchange")),setTimeout(function(){f=!1},50))}).on("mouseup keydown keyup",function(t){(t.ctrlKey||t.metaKey)&&!t.altKey||setTimeout(function(){f=!1},50);clearTimeout(o);o=setTimeout(function(){n.updateButtonPaneStatus()},50)}).on("focus blur",function(t){if(n.$c.trigger("tbw"+t.type),t.type==="blur"&&n.clearButtonPaneStatus(),n.o.autogrowOnEnter){if(n.autogrowOnEnterDontClose)return;t.type==="focus"?(n.autogrowOnEnterWasFocused=!0,n.autogrowEditorOnEnter()):n.o.autogrow||(n.$ed.css({height:n.$ed.css("min-height")}),n.$c.trigger("tbwresize"))}}).on("cut drop",function(){setTimeout(function(){n.semanticCode(!1,!0);n.$c.trigger("tbwchange")},0)}).on("paste",function(i){if(n.o.removeformatPasted){i.preventDefault();t.getSelection&&t.getSelection().deleteFromDocument&&t.getSelection().deleteFromDocument();try{var u=t.clipboardData.getData("Text");try{n.doc.selection.createRange().pasteHTML(u)}catch(f){n.doc.getSelection().getRangeAt(0).insertNode(n.doc.createTextNode(u))}n.$c.trigger("tbwchange",i)}catch(e){n.execCmd("insertText",(i.originalEvent||i).clipboardData.getData("text/plain"))}}r.each(n.pasteHandlers,function(n,t){t(i)});setTimeout(function(){n.semanticCode(!1,!0);n.$c.trigger("tbwpaste",i);n.$c.trigger("tbwchange")},0)});n.$ta.on("keyup",function(){n.$c.trigger("tbwchange")}).on("paste",function(){setTimeout(function(){n.$c.trigger("tbwchange")},0)});n.$box.on("keydown",function(t){if(t.which===27&&r("."+i+"modal-box",n.$box).length===1)return n.closeModal(),!1})},autogrowEditorOnEnter:function(){var n=this,t,i;n.$ed.removeClass("autogrow-on-enter");t=n.$ed[0].clientHeight;n.$ed.height("auto");i=n.$ed[0].scrollHeight;n.$ed.addClass("autogrow-on-enter");t!==i&&(n.$ed.height(t),setTimeout(function(){n.$ed.css({height:i});n.$c.trigger("tbwresize")},0))},buildBtnPane:function(){var n=this,t=n.o.prefix,i=n.$btnPane=r("<div/>",{"class":t+"button-pane"});r.each(n.o.btns,function(u,f){r.isArray(f)||(f=[f]);var e=r("<div/>",{"class":t+"button-group "+(f.indexOf("fullscreen")>=0?t+"right":"")});r.each(f,function(t,i){try{n.isSupportedBtn(i)&&e.append(n.buildBtn(i))}catch(r){}});e.html().trim().length>0&&i.append(e)});n.$box.prepend(i)},buildBtn:function(n){var i=this,u=i.o.prefix,t=i.btnsDef[n],f=t.dropdown,h=t.hasIcon!=null?t.hasIcon:!0,l=i.lang[n]||n,c=r("<button/>",{type:"button","class":u+n+"-button "+(t.class||"")+(h?"":" "+u+"textual-button"),html:i.hasSvg&&h?'<svg><use xlink:href="'+i.svgPath+"#"+u+(t.ico||n).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/><\/svg>':i.hideButtonTexts?"":t.text||t.title||i.lang[n]||n,title:(t.title||t.text||l)+(t.key?" ("+(i.isMac?"Cmd":"Ctrl")+" + "+t.key+")":""),tabindex:-1,mousedown:function(){return(gaEvent("Click: "+n),(!f||r("."+n+"-"+u+"dropdown",i.$box).is(":hidden"))&&r("body",i.doc).trigger("mousedown"),(i.$btnPane.hasClass(u+"disable")||i.$box.hasClass(u+"disabled"))&&!r(this).hasClass(u+"active")&&!r(this).hasClass(u+"not-disable"))?!1:(i.execCmd((f?"dropdown":!1)||t.fn||n,t.param||n,t.forceCss),!1)}}),e,o,s;return f?(c.addClass(u+"open-dropdown"),e=u+"dropdown",o={"class":e+"-"+n+" "+e+" "+u+"fixed-top "+(t.dropdownClass||"")},o["data-"+e]=n,s=r("<div/>",o),r.each(f,function(n,t){i.btnsDef[t]&&i.isSupportedBtn(t)&&s.append(i.buildSubBtn(t))}),i.$box.append(s.hide())):t.key&&(i.keys[t.key]={fn:t.fn||n,param:t.param||n}),f||(i.tagToButton[(t.tag||n).toLowerCase()]=n),c},buildSubBtn:function(n){var i=this,u=i.o.prefix,t=i.btnsDef[n],f=t.hasIcon!=null?t.hasIcon:!0;return t.key&&(i.keys[t.key]={fn:t.fn||n,param:t.param||n}),i.tagToButton[(t.tag||n).toLowerCase()]=n,r("<button/>",{type:"button","class":u+n+"-dropdown-button "+(t.class||"")+(t.ico?" "+u+t.ico+"-button":""),html:i.hasSvg&&f?'<svg><use xlink:href="'+i.svgPath+"#"+u+(t.ico||n).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/><\/svg>'+(t.text||t.title||i.lang[n]||n):t.text||t.title||i.lang[n]||n,title:t.key?"("+(i.isMac?"Cmd":"Ctrl")+" + "+t.key+")":null,style:t.style||null,mousedown:function(){return r("body",i.doc).trigger("mousedown"),i.execCmd(t.fn||n,t.param||n,t.forceCss),!1}})},isSupportedBtn:function(n){try{return this.btnsDef[n].isSupported()}catch(t){}return!0},buildOverlay:function(){var n=this;return n.$overlay=r("<div/>",{"class":n.o.prefix+"overlay"}).appendTo(n.$box),n.$overlay},showOverlay:function(){var n=this;r(t).trigger("scroll");n.$overlay.fadeIn(200);n.$box.addClass(n.o.prefix+"box-blur")},hideOverlay:function(){var n=this;n.$overlay.fadeOut(50);n.$box.removeClass(n.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var n=this,u=n.o.fixedFullWidth,i=n.$box;if(n.o.fixedBtnPane){n.isFixed=!1;r(t).on("scroll."+n.eventNamespace+" resize."+n.eventNamespace,function(){if(i){n.syncCode();var e=r(t).scrollTop(),o=i.offset().top+1,f=n.$btnPane,s=f.outerHeight()-2;e-o>0&&e-o-n.height<0?(n.isFixed||(n.isFixed=!0,f.css({position:"fixed",top:"50px",left:u?0:"auto",zIndex:7}),n.$box.css({paddingTop:f.height()})),f.css({width:u?"100%":i.width()-1}),r("."+n.o.prefix+"fixed-top",i).css({position:u?"fixed":"absolute",top:u?s:s+(e-o),zIndex:15})):n.isFixed&&(n.isFixed=!1,f.removeAttr("style"),n.$box.css({paddingTop:0}),r("."+n.o.prefix+"fixed-top",i).css({position:"absolute",top:s}))}})}},setDisabled:function(n){var t=this,i=t.o.prefix;t.disabled=n;n?t.$ta.attr("disabled",!0):t.$ta.removeAttr("disabled");t.$box.toggleClass(i+"disabled",n);t.$ed.attr("contenteditable",!n)},destroy:function(){var n=this,i=n.o.prefix;n.isTextarea?n.$box.after(n.$ta.css({height:""}).val(n.html()).removeClass(i+"textarea").show()):n.$box.after(n.$ed.css({height:""}).removeClass(i+"editor").removeAttr("contenteditable").removeAttr("dir").html(n.html()).show());n.$ed.off("dblclick","img");n.destroyPlugins();n.$box.remove();n.$c.removeData("trumbowyg");r("body").removeClass(i+"body-fullscreen");n.$c.trigger("tbwclose");r(t).off("scroll."+n.eventNamespace+" resize."+n.eventNamespace)},empty:function(){this.$ta.val("");this.syncCode(!0)},toggle:function(){var n=this,t=n.o.prefix;n.o.autogrowOnEnter&&(n.autogrowOnEnterDontClose=!n.$box.hasClass(t+"editor-hidden"));n.semanticCode(!1,!0);setTimeout(function(){n.doc.activeElement.blur();n.$box.toggleClass(t+"editor-hidden "+t+"editor-visible");n.$btnPane.toggleClass(t+"disable");r("."+t+"viewHTML-button",n.$btnPane).toggleClass(t+"active");n.$box.hasClass(t+"editor-visible")?n.$ta.attr("tabindex",-1):n.$ta.removeAttr("tabindex");n.o.autogrowOnEnter&&!n.autogrowOnEnterDontClose&&n.autogrowEditorOnEnter()},0)},dropdown:function(n){var i=this,e=r("body",i.doc),u=i.o.prefix,o=r("[data-"+u+"dropdown="+n+"]",i.$box),f=r("."+u+n+"-button",i.$btnPane),h=o.is(":hidden"),s;if(e.trigger("mousedown"),h){s=f.offset().left;f.addClass(u+"active");o.css({position:"absolute",top:f.offset().top-i.$btnPane.offset().top+f.outerHeight(),left:i.o.fixedFullWidth&&i.isFixed?s:s-i.$btnPane.offset().left}).show();r(t).trigger("scroll");e.on("mousedown."+i.eventNamespace,function(n){o.is(n.target)||(r("."+u+"dropdown",i.$box).hide(),r("."+u+"active",i.$btnPane).removeClass(u+"active"),e.off("mousedown."+i.eventNamespace))})}},html:function(n){var t=this;return n!=null?(t.$ta.val(n),t.syncCode(!0),t.$c.trigger("tbwchange"),t):t.$ta.val()},syncTextarea:function(){var n=this;n.$ta.val(n.$ed.text().trim().length>0||n.$ed.find(n.o.tagsToKeep.join(",")).length>0?n.$ed.html():"")},syncCode:function(n){var t=this,f,i,u;!n&&t.$ed.is(":visible")?t.syncTextarea():(f=r("<div>").html(t.$ta.val()),i=r("<div>").append(f),r(t.o.tagsToRemove.join(","),i).remove(),t.$ed.html(i.contents().html()));t.o.autogrow&&(t.height=t.$ed.height(),t.height!==t.$ta.css("height")&&(t.$ta.css({height:t.height}),t.$c.trigger("tbwresize")));t.o.autogrowOnEnter&&(t.$ed.height("auto"),u=t.autogrowOnEnterWasFocused?t.$ed[0].scrollHeight:t.$ed.css("min-height"),u!==t.$ta.css("height")&&(t.$ed.css({height:u}),t.$c.trigger("tbwresize")))},semanticCode:function(n,t,i){var u=this,f,o,e;u.saveRange();u.syncCode(n);u.o.semantic&&(u.semanticTag("b",u.o.semanticKeepAttributes),u.semanticTag("i",u.o.semanticKeepAttributes),u.semanticTag("s",u.o.semanticKeepAttributes),u.semanticTag("strike",u.o.semanticKeepAttributes),t&&(f=u.o.inlineElementsSelector,o=":not("+f+")",u.$ed.contents().filter(function(){return this.nodeType===3&&this.nodeValue.trim().length>0}).wrap("<span data-tbw/>"),e=function(n){if(n.length!==0){var t=n.nextUntil(o).addBack().wrapAll("<p/>").parent(),i=t.nextAll(f).first();t.next("br").remove();e(i)}},e(u.$ed.children(f).first()),u.semanticTag("div",!0),r("[data-tbw]",u.$ed).contents().unwrap(),u.$ed.find("p:empty").remove()),i||u.restoreRange(),u.syncTextarea())},semanticTag:function(n,t){var i;if(this.o.semantic!=null&&typeof this.o.semantic=="object"&&this.o.semantic.hasOwnProperty(n))i=this.o.semantic[n];else if(this.o.semantic===!0&&this.DEFAULT_SEMANTIC_MAP.hasOwnProperty(n))i=this.DEFAULT_SEMANTIC_MAP[n];else return;r(n,this.$ed).each(function(){var n=r(this);if(n.contents().length===0)return!1;n.wrap("<"+i+"/>");t&&r.each(n.prop("attributes"),function(){n.parent().attr(this.name,this.value)});n.contents().unwrap()})},createLink:function(){for(var n=this,u=n.doc.getSelection(),t=u.focusNode,o=(new XMLSerializer).serializeToString(u.getRangeAt(0).cloneContents()),s,h,c,i,f,e;["A","DIV"].indexOf(t.nodeName)<0;)t=t.parentNode;t&&t.nodeName==="A"&&(i=r(t),o=i.text(),s=i.attr("href"),n.o.minimalLinks||(h=i.attr("title"),c=i.attr("target")),f=n.doc.createRange(),f.selectNode(t),u.removeAllRanges(),u.addRange(f));n.saveRange();e={url:{label:"URL",required:!0,value:s},text:{label:n.lang.text,value:o}};n.o.minimalLinks||Object.assign(e,{title:{label:n.lang.title,value:h},target:{label:n.lang.target,value:c}});n.openModalInsert(n.lang.createLink,e,function(t){var u=n.prependUrlPrefix(t.url),i;return u.length?(i=r(['<a href="',u,'">',t.text||t.url,"<\/a>"].join("")),n.o.minimalLinks||(t.title.length>0&&i.attr("title",t.title),t.target.length>0&&i.attr("target",t.target)),n.range.deleteContents(),n.range.insertNode(i[0]),n.syncCode(),n.$c.trigger("tbwchange"),!0):!1})},prependUrlPrefix:function(n){var t=this,i,r;return t.urlPrefix?(i=/^([a-z][-+.a-z0-9]*:|\/|#)/i,i.test(n))?n:(r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,r.test(n))?"mailto:"+n:t.urlPrefix+n:n},unlink:function(){var i=this,t=i.doc.getSelection(),n=t.focusNode,r;if(t.isCollapsed){while(["A","DIV"].indexOf(n.nodeName)<0)n=n.parentNode;n&&n.nodeName==="A"&&(r=i.doc.createRange(),r.selectNode(n),t.removeAllRanges(),t.addRange(r))}i.execCmd("unlink",undefined,undefined,!0)},insertImage:function(){var n=this,t;n.saveRange();t={url:{label:"URL",required:!0},alt:{label:n.lang.description,value:n.getRangeText()}};n.o.imageWidthModalEdit&&(t.width={});n.openModalInsert(n.lang.insertImage,t,function(t){n.execCmd("insertImage",t.url,!1,!0);var i=r('img[src="'+t.url+'"]:not([alt])',n.$box);return i.attr("alt",t.alt),n.o.imageWidthModalEdit&&i.attr({width:t.width}),n.syncCode(),n.$c.trigger("tbwchange"),!0})},fullscreen:function(){var n=this,f=n.o.prefix,u=f+"fullscreen",e=u+"-placeholder",i,o=n.$box.outerHeight();n.$box.toggleClass(u);i=n.$box.hasClass(u);i?n.$box.before(r("<div/>",{"class":e}).css({height:o})):r("."+e).remove();r("body").toggleClass(f+"body-fullscreen",i);r(t).trigger("scroll");n.$c.trigger("tbw"+(i?"open":"close")+"fullscreen")},execCmd:function(n,t,i,r){var u=this;r=!!r||"";n!=="dropdown"&&u.$ed.focus();try{u.doc.execCommand("styleWithCSS",!1,i||!1)}catch(f){}try{u[n+r](t)}catch(f){try{n(t)}catch(e){n==="insertHorizontalRule"?t=undefined:n==="formatBlock"&&u.isIE&&(t="<"+t+">");u.doc.execCommand(n,!1,t)}n!=="dropdown"&&(u.updateButtonPaneStatus(),u.$c.trigger("tbwchange"))}},openModal:function(n,i){var e=this,s=e.o.prefix,o,c,h;if(r("."+s+"modal-box",e.$box).length>0)return!1;e.o.autogrowOnEnter&&(e.autogrowOnEnterDontClose=!0);e.saveRange();e.showOverlay();e.$btnPane.addClass(s+"disable");o=r("<div/>",{"class":s+"modal "+s+"fixed-top"}).css({top:e.$box.offset().top+e.$btnPane.height(),zIndex:99999}).appendTo(r(e.doc.body));e.$overlay.one("click",function(){return o.trigger(f),!1});return c=r("<form/>",{action:"",html:i}).on("submit",function(){return o.trigger(u),!1}).on("reset",function(){return o.trigger(f),!1}).on("submit reset",function(){e.o.autogrowOnEnter&&(e.autogrowOnEnterDontClose=!1)}),h=r("<div/>",{"class":s+"modal-box",html:c}).css({top:"-"+e.$btnPane.outerHeight(),opacity:0}).appendTo(o).animate({top:0,opacity:1},100),r("<span/>",{text:n,"class":s+"modal-title"}).prependTo(h),o.height(h.outerHeight()+10),r("input:first",h).focus(),e.buildModalBtn("submit",h),e.buildModalBtn("reset",h),r(t).trigger("scroll"),o},buildModalBtn:function(n,t){var i=this,u=i.o.prefix;return r("<button/>",{"class":u+"modal-button "+u+"modal-"+n,type:n,text:i.lang[n]||n}).appendTo(r("form",t))},closeModal:function(){var n=this,i=n.o.prefix,t;n.$btnPane.removeClass(i+"disable");n.$overlay.off();t=r("."+i+"modal-box",r(n.doc.body));t.animate({top:"-"+t.height()},100,function(){t.parent().remove();n.hideOverlay()});n.restoreRange()},openModalInsert:function(n,t,i){var e=this,h=e.o.prefix,o=e.lang,s="";r.each(t,function(n,t){var i=t.label||n,u=t.name||n,r=t.attributes||{},f=Object.keys(r).map(function(n){return n+'="'+r[n]+'"'}).join(" ");s+='<label><input type="'+(t.type||"text")+'" name="'+u+'"'+(t.type==="checkbox"&&t.value?' checked="checked"':' value="'+(t.value||"").replace(/"/g,"&quot;"))+'"'+f+'><span class="'+h+'input-infos"><span>'+(o[i]?o[i]:i)+"<\/span><\/span><\/label>"});return e.openModal(n,s).on(u,function(){var o=r("form",r(this)),f=!0,n={};r.each(t,function(t,i){var u=i.name||t,s=r('input[name="'+u+'"]',o),h=s.attr("type");switch(h.toLowerCase()){case"checkbox":n[u]=s.is(":checked");break;case"radio":n[u]=s.filter(":checked").val();break;default:n[u]=r.trim(s.val())}i.required&&n[u]===""?(f=!1,e.addErrorOnModalField(s,e.lang.required)):i.pattern&&!i.pattern.test(n[u])&&(f=!1,e.addErrorOnModalField(s,i.patternError))});f&&(e.restoreRange(),i(n,t)&&(e.syncCode(),e.$c.trigger("tbwchange"),e.closeModal(),r(this).off(u)))}).one(f,function(){r(this).off(u);e.closeModal()})},addErrorOnModalField:function(n,t){var i=this.o.prefix,f=i+"msg-error",u=n.parent();n.on("change keyup",function(){u.removeClass(i+"input-error");setTimeout(function(){u.find("."+f).remove()},150)});u.addClass(i+"input-error").find("input+span").append(r("<span/>",{"class":f,text:t}))},getDefaultImgDblClickHandler:function(){var n=this;return function(){var t=r(this),i=t.attr("src"),f="(Base64)",u;return i.indexOf("data:image")===0&&(i=f),u={url:{label:"URL",value:i,required:!0},alt:{label:n.lang.description,value:t.attr("alt")}},n.o.imageWidthModalEdit&&(u.width={value:t.attr("width")?t.attr("width"):""}),n.openModalInsert(n.lang.insertImage,u,function(i){return i.url!==f&&t.attr({src:i.url}),t.attr({alt:i.alt}),n.o.imageWidthModalEdit&&(parseInt(i.width)>0?t.attr({width:i.width}):t.removeAttr("width")),!0}),!1}},saveRange:function(){var n=this,r=n.doc.getSelection(),t,i,u;(n.range=null,r&&r.rangeCount)&&(t=n.range=r.getRangeAt(0),i=n.doc.createRange(),i.selectNodeContents(n.$ed[0]),i.setEnd(t.startContainer,t.startOffset),u=(i+"").length,n.metaRange={start:u,end:u+(t+"").length})},restoreRange:function(){var r=this,n=r.metaRange,h=r.range,c=r.doc.getSelection(),u,f,s,e;if(h){if(n&&n.start!==n.end){var t=0,l=[r.$ed[0]],i,o=!1,a=!1;for(u=r.doc.createRange();!a&&(i=l.pop());)if(i.nodeType===3)f=t+i.length,!o&&n.start>=t&&n.start<=f&&(u.setStart(i,n.start-t),o=!0),o&&n.end>=t&&n.end<=f&&(u.setEnd(i,n.end-t),a=!0),t=f;else for(s=i.childNodes,e=s.length;e>0;)e-=1,l.push(s[e])}try{c.removeAllRanges()}catch(v){}c.addRange(u||h)}},getRangeText:function(){return this.range+""},clearButtonPaneStatus:function(){var t=this,n=t.o.prefix,u=n+"active-button "+n+"active",i=n+"original-icon";r("."+n+"active-button",t.$btnPane).removeClass(u);r("."+i,t.$btnPane).each(function(){r(this).find("svg use").attr("xlink:href",r(this).data(i))})},updateButtonPaneStatus:function(){var n=this,t=n.o.prefix,i=t+"active-button "+t+"active",u=t+"original-icon",f=n.getTagsRecursive(n.doc.getSelection().focusNode);n.clearButtonPaneStatus();r.each(f,function(f,e){var h=n.tagToButton[e.toLowerCase()],o=r("."+t+h+"-button",n.$btnPane);if(o.length>0)o.addClass(i);else try{o=r("."+t+"dropdown ."+t+h+"-dropdown-button",n.$box);var c=o.find("svg use"),a=o.parent().data(t+"dropdown"),s=r("."+t+a+"-button",n.$box),l=s.find("svg use");s.addClass(i);n.o.changeActiveDropdownIcon&&c.length>0&&(s.addClass(u).data(u,l.attr("xlink:href")),l.attr("xlink:href",c.attr("xlink:href")))}catch(v){}})},getTagsRecursive:function(n,t){var u=this,i;if(t=t||(n&&n.tagName?[n.tagName]:[]),n&&n.parentNode)n=n.parentNode;else return t;return(i=n.tagName,i==="DIV")?t:(i==="P"&&n.style.textAlign!==""&&t.push(n.style.textAlign),r.each(u.tagHandlers,function(i,r){t=t.concat(r(n,u))}),t.push(i),u.getTagsRecursive(n,t).filter(function(n){return n!=null}))},initPlugins:function(){var n=this;n.loadedPlugins=[];r.each(r.trumbowyg.plugins,function(t,i){(!i.shouldInit||i.shouldInit(n))&&(i.init(n),i.tagHandler&&n.tagHandlers.push(i.tagHandler),n.loadedPlugins.push(i))})},destroyPlugins:function(){var n=this;r.each(this.loadedPlugins,function(t,i){i.destroy&&i.destroy(n)})}}}(navigator,window,document,jQuery);