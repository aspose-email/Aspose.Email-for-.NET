(function(n){n.metadata=function(t,i,r){var p,f;const h=1,v=2,c=10,d={0:"Boolean",1:"DateTime",2:"Double",3:"Number",4:"String",5:"StringArray",6:"ObjectArray",7:"ByteArray",8:"Other"};var e=h,l=1,u={},w=function(n,t){const r="Value and Type do not match, please try again!";var i;switch(t){case 4:case 5:case 6:break;case 1:if(isNaN(Date.parse(n)))return window.alert(r),null;break;case 0:if(i=n.toLowerCase(),i==="true")n=!0;else if(i==="false")n=!1;else return window.alert(r),null;break;case 2:case 3:if(i=parseFloat(n),isNaN(i)||!n.match(/^[+-]?\d+(\.\d+)?$/))return window.alert(r),null;n=t===2?i:Math.floor(i);break;case 7:if(i=n.split(","),i.reduce(function(n,t){return n===!0&&t.trim().match(/^[+-]?\d+(\.\d+)?$/)},!0)===!1)return window.alert(r),null;break;default:return window.alert("Unknown type was specified, please try again!"),null}return n},g=function(){n(".filedrop").removeClass("hidden");n("#metadata").addClass("hidden");fileDrop.reset()},a=function(){var t,i,r;if(u.id&&(t=n("tr#item-"+u.id),t.length>0&&(i=t.find("td[data-item-value]"),r=t.find("td[data-item-button]"),i.length&&r.length))){u.button.on("click",b);i.empty().append(u.value);r.empty().append(u.button)}},b=function(n){n.preventDefault();n.stopPropagation();var t=parseInt(event.target.getAttribute("data-target"));it(t)},nt=function(n){n.preventDefault();n.stopPropagation();var t=parseInt(event.target.getAttribute("data-target"));rt(t)},k=function(i){var f,e,r;if(i&&(i.preventDefault(),i.stopPropagation()),f=w(n("input#item-value-"+u.id).val(),u.type),f!==null){for(e=!1,r=0;r<t.BuiltIn.length;r++)if(t.BuiltIn[r].Id===u.id){t.BuiltIn[r].Value=f;t.BuiltIn[r].Changed=!0;e=!0;break}if(!e)for(r=0;r<t.Custom.length;r++)if(t.Custom[r].Id===u.id){t.Custom[r].Value=f;e=!0;break}e&&(u.value=n("<span>"+f+"<\/span>"));a()}},tt=function(n){n.preventDefault();n.stopPropagation();a()},it=function(t){var i,c,e,o,s;if(a(),i=n("tr#item-"+t),i.length>0){var f=i.find("td[data-item-value]"),r=i.find("td[data-item-button]"),h=i.find("td[data-item-type]");if(f.length&&r.length&&h.length){c=f.find("span").html();u.id=t;u.value=f.children().detach();u.button=r.children().detach();u.type=parseInt(h.attr("data-item-type"));u.button.off("click");e=n('<input id="item-value-'+t+'" type="text" value="" />');e.val(c.toString());e.on("keydown",function(n){n.keyCode===13&&(n.preventDefault(),n.stopPropagation(),k())});f.append(e);o=n('<input type="image" src="../img/grid-update-ico.png" title="Update" alt="Update" style="border-width:0" />');o.on("click",k);r.append(o);r.append("&nbsp;");s=n('<input type="image" src="../img/grid-cancel-ico.png" title="Cancel" alt="Cancel" style="border-width:0" />');s.on("click",tt);r.append(s)}}},rt=function(i){var f,u,r;if(a(),f=n("tr#item-"+i),f.length>0){for(u=!1,r=0;r<t.Custom.length;r++)if(t.Custom[r].Id===i){u=!0;break}u&&(t.Custom.splice(r,1),s())}},y=function(){var r=n("#new-property-name").val(),u,f,i,e;if(!r||r.match(/^\s+$/)){window.alert("Property name can not be empty, please try again!");return}if(u=parseInt(n("#new-property-type").val()),f=w(n("#new-property-value").val(),u),f!==null){i=t.BuiltIn.length;do i+=1,e=t.Custom.findIndex(n=>n.Id===i);while(e!==-1);t.Custom.push({Id:i,Name:r,Value:f,Type:u,LinkSource:"",IsLinkToContent:!1});n("#new-property-name").val("");n("#new-property-value").val("");n("#new-property-type").val("4");l=Math.ceil(t.Custom.length/c);s()}},s=function(){var k=(l-1)*c,p=k+c,r=e===h?t.BuiltIn:t.Custom,g=Math.ceil(r.length/c),a,u,f,o,w,y,i;r.length<p&&(p=r.length);r=r.slice(k,p);a=n("<tbody>");for(i in r){f=n("<td data-item-button>");o=n('<input type="image" src="../img/grid-edit-ico.png" alt="Edit" title="Edit" style="border-width:0" data-target="'+r[i].Id+'" />');o.on("click",b);if(f.append(o),e===v){o=n('<input type="image" src="../img/grid-delete-ico.png" alt="Delete" title="Delete" style="border-width:0" data-target="'+r[i].Id+'" />');o.on("click",nt);f.append("&nbsp;");f.append(o)}u=n('<tr id="item-'+r[i].Id+'">');u.append(n("<td><span>"+r[i].Name+"<\/span><\/td>"));u.append(n("<td data-item-value><span>"+r[i].Value+"<\/span><\/td>"));u.append(n('<td data-item-type="'+r[i].Type+'"><span>'+d[r[i].Type]+"<\/span><\/td>"));u.append(f);a.append(u)}if(g>1)for(u=n("<tr>"),f=n('<td colspan="4">'),w=n('<table border="0">'),f.append(w),u.append(f),a.append(u),u=n("<tr>"),w.append(u),i=1;i<=g;i++){if(f=n("<td>"),i===l)y=n("<span>"+i+"<\/span>");else{y=n('<a href="javascript:void(0)">'+i+"<\/a>");y.on("click",function(n){l=parseInt(n.target.innerHTML,10);s()})}f.append(y);u.append(f)}n("table#metadata-props > tbody").remove();n("table#metadata-props").append(a)},ut=function(){showLoader();const u=o.APIBasePath+"AsposeEmailMetadata/download",f={BuiltIn:t.BuiltIn.map(n=>({Name:n.Name,Value:n.Value,Changed:n.Changed,Type:n.Type,LinkSource:n.LinkSource,IsLinkToContent:n.IsLinkToContent})),Custom:t.Custom.map(n=>({Name:n.Name,Value:n.Value,Type:n.Type,LinkSource:n.LinkSource,IsLinkToContent:n.IsLinkToContent}))};n.ajax({method:"POST",url:u,data:JSON.stringify({id:i,FileName:r,properties:f}),contentType:"application/json",cache:!1,timeout:6e5,success:workSuccess,error:n=>{n.data!==undefined&&n.data.Status!==undefined?showAlert(n.data.Status):showAlert("Error "+n.status+": "+n.statusText)}})},ft=function(){if(window.confirm("Are you sure you want to clear all metadata?")){showLoader();const t=o.APIBasePath+"AsposeEmailMetadata/clear";n.ajax({method:"POST",url:t,data:JSON.stringify({id:i,FileName:r}),contentType:"application/json",cache:!1,timeout:6e5,success:workSuccess,error:n=>{n.data!==undefined&&n.data.Status!==undefined?showAlert(n.data.Status):showAlert("Error "+n.status+": "+n.statusText)}})}};n("#metadata-mode-builtin").on("click",function(){e!==h&&(e=h,s(),n("#new-property").addClass("hidden"))});n("#metadata-mode-custom").on("click",function(){e!==v&&(e=v,s(),n("#new-property").removeClass("hidden"))});for(p=1,f=0;f<t.BuiltIn.length;f++)t.BuiltIn[f].Id=p++;for(f=0;f<t.Custom.length;f++)t.Custom[f].Id=p++;n("#btn-save").on("click",ut);n("#btn-clear-all").on("click",ft);n("#btn-cancel").on("click",g);n("#new-property-name").on("keydown",function(n){n.keyCode===13&&(n.preventDefault(),n.stopPropagation(),y())});n("#new-property-value").on("keydown",function(n){n.keyCode===13&&(n.preventDefault(),n.stopPropagation(),y())});n("#new-property-save").on("click",y);n(".filedrop").addClass("hidden");n("#metadata-edit").removeClass("hidden");hideLoader();s()}})(jQuery);