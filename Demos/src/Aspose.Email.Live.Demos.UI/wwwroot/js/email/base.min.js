function showLoader(){$(".progress > .progress-bar").html("0%");$(".progress > .progress-bar").css("width","0%");$("#loader").removeClass("hidden");hideAlert()}function hideLoader(){$("#loader").addClass("hidden")}function generateViewerLink(n){var t=n.FolderName!==undefined?n.FolderName:n.id;return encodeURI(o.ViewerPath+"FileName="+n.FileName+"&FolderName="+t+"&CallbackURL="+o.AppURL)}function generateEditorLink(n){var t=n.FolderName!==undefined?n.FolderName:n.id;return t===undefined?encodeURI(o.EditorPath+"CallbackURL="+o.AppURL):encodeURI(o.EditorPath+"FileName="+n.FileName+"&FolderName="+t+"&CallbackURL="+o.AppURL)}function sendPageView(n){if("ga"in window)try{var t=ga.getAll()[0];t!==undefined&&t.send("pageview",n)}catch(i){}}function workSuccess(n){if(hideLoader(),n.StatusCode===200&&n.FileName!==null){if(n.FileProcessingErrorCode!==undefined&&n.FileProcessingErrorCode!==0){lastErrorInfo.folderId=n.FolderName;lastErrorInfo.error=o.FileProcessingErrorCodes[n.FileProcessingErrorCode];showAlert(o.FileProcessingErrorCodes[n.FileProcessingErrorCode]);showReportWindow(o.FileProcessingErrorCodes[n.FileProcessingErrorCode]);return}if($("#WorkPlaceHolder").addClass("hidden"),$(".appfeaturesectionlist").addClass("hidden"),$(".sub-menu-container").addClass("hidden"),$(".overview").addClass("hidden"),$(".howtolist").addClass("hidden"),$(".app-features-section").addClass("hidden"),$(".app-product-section").addClass("hidden"),$("#DownloadPlaceHolder").removeClass("hidden"),$("#OtherApps").removeClass("hidden"),o.ReturnFromViewer===undefined){const n=o.AppDownloadURL.indexOf("?"),t=n===-1?o.AppDownloadURL:o.AppDownloadURL.substring(0,n);sendPageView(t)}var t=encodeURI(o.APIBasePath+`Common/DownloadFile/${n.FolderName}?file=${n.FileName}`);if($("#DownloadButton").attr("href",t),o.DownloadUrl=t,o.ShowViewerButton){let t=$("#ViewerLink"),i=n.FileName.lastIndexOf("."),r=i>=0?n.FileName.substring(i+1).toUpperCase():null;if(r!==null&&t.length&&VIEWABLE_EXTENSIONS.indexOf(r)!==-1)t.on("click",function(t){t.preventDefault();t.stopPropagation();openIframe(generateViewerLink(n),"/email/viewer","/email/view")});else t.hide(),$(t[0].parentNode.previousElementSibling).hide()}}else lastErrorInfo.folderId=n.FolderName,lastErrorInfo.error=n.Status,showAlert(n.Status),showReportWindow(n.Status)}function sendEmail(){var n=$("#EmailToInput").val(),t;if(!n||!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(n).toLowerCase())){window.alert("Please specify the valid email address!");return}t={appname:o.AppName,email:n,url:o.DownloadUrl,title:$("#ProductTitle")[0].innerText};$("#sendEmailModal").modal("hide");$("#sendEmailButton").addClass("hidden");let i=o.APIBasePath+"Common/sendemail";$.ajax({method:"POST",url:i,data:JSON.stringify(t),contentType:"application/json",dataType:"json",success:n=>{showMessage(n.message)},complete:()=>{$("#sendEmailButton").removeClass("hidden"),hideLoader()},error:handleAjaxError})}function sendFeedback(n){var t=typeof n=="string"?n:$("#feedbackText").val(),i;if(t&&!t.match(/^\s+$/)&&!(t.length>1e3)){if(!n&&"ga"in window)try{i=window.ga.getAll()[0];i!==undefined&&i.send("event",{eventCategory:"Social",eventAction:"feedback-in-download"})}catch(u){}let r=o.APIBasePath+"Common/sendfeedback";$.ajax({method:"POST",url:r,data:JSON.stringify({appname:o.AppName,text:t}),contentType:"application/json",dataType:"json",success:n=>{showMessage(n.message),$("#feedback").hide()},error:handleAjaxError})}}function hideAlert(){$("#alertMessage").addClass("hidden");$("#alertMessage").text("");$("#alertSuccess").addClass("hidden");$("#alertSuccess").text("")}function showAlert(n){hideLoader();$("#alertMessage").html(n);$("#alertMessage").removeClass("hidden");$("#alertMessage").fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100)}function showMessage(n){hideLoader();$("#alertSuccess").text(n);$("#alertSuccess").removeClass("hidden")}function progress(n){if(n.lengthComputable){var i=n.total,r=n.loaded,t=Math.round(r*100/i);t=t+"%";$(".progress > .progress-bar").html(t);$(".progress > .progress-bar").css("width",t)}}function removeAllFileBlocks(){fileDrop.droppedFiles.forEach(function(n){$("#fileupload-"+n.id).remove()});fileDrop.droppedFiles=[];hideLoader()}function openIframe(n,t,i){window.history.pushState(null,null,t);$("body").css("overflow-y","hidden");var r=$('<div id="iframe-wrap"><\/div>');$("<iframe>",{src:n,id:"iframe-document",frameborder:0,scrolling:"yes"}).appendTo(r);r.appendTo("body");sendPageView(i)}function closeIframe(){removeAllFileBlocks();$("div#iframe-wrap").remove();$("body").css("overflow-y","auto")}function request(n,t){showLoader();$.ajax({method:"POST",url:n,data:t,processData:!1,contentType:!1,cache:!1,timeout:1e6,success:workSuccess,xhr:function(){var n=$.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",progress,!1),n},error:handleAjaxError})}function requestMerger(){let n=fileDrop.prepareFormData(2,o.MaximumUploadFiles);if(n!==null){let t=o.APIBasePath+"AsposeEmailMerger/Merge?outputType="+$("#saveAs").val();request(t,n)}}function requestParser(){let n=fileDrop.prepareFormData();if(n!==null){let t=o.APIBasePath+"AsposeEmailParser/Parse";request(t,n)}}function requestDisposable(){var i=o,n=$("#DisposableQuery").val(),t;if(n==null||n.length<1){showAlert(i.EmailInputMessage);return}t=new FormData;t.append("email",n);let r=o.APIBasePath+"AsposeEmailDisposable/IsDisposable";requestPostDisposable(r,t)}function requestPostDisposable(n,t){var i=o;showLoader();$.ajax({method:"POST",url:n,data:t,processData:!1,contentType:!1,cache:!1,timeout:1e6,success:function(n){n?showMessage(i.EmailDisposableMessage):showMessage(i.EmailNotDisposableMessage)},xhr:function(){var n=$.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",progress,!1),n},error:handleAjaxError})}function requestPasswordStrength(){var i=o,n=$("#ugpassword").val(),t;if(n==null||n.length<1){showAlert(i.PasswordInputMessage);return}t=new FormData;t.append("password",n);let r=o.APIBasePath+"AsposeEmailPasswordStrength/CheckStrength";requestPostPasswordStrength(r,t)}function requestPostPasswordStrength(n,t){var i=o;showLoader();$.ajax({method:"POST",url:n,data:t,processData:!1,contentType:!1,cache:!1,timeout:1e6,success:function(n){$(function(){var u=$("<div/>"),f=$("<result/>"),t=$('<table class="admin_mGrid" cellspacing="0" border="0" style="border-collapse:collapse; margin-bottom:50px;" />'),e=$("<thead/>"),o=$("<tr/>"),s=$("<tbody/>"),r;o.append($("<th>").text("")).append($("<th>").text(i.Keys.PasswordStrengthKey)).append($("<th>").text(i.Keys.PasswordStrengthCount)).append($("<th>").text(i.Keys.PasswordStrengthBonus));r=0;$.each(n,function(n,t){r+=t.Bonus;var f=$("<tr>").append($("<td>").text(n+1)).append($("<td>").text(i.Keys[t.NameKey])).append($("<td>").text(t.Count)).append($("<td>").text(t.Bonus)),u="";switch(t.Rate){case 1:u="blue";break;case 2:u="green";break;case 3:u="sandybrown";break;case 4:u="red"}f.attr("style","font-weight: bold;color:"+u);s.append(f)});e.append(o);t.append(e);t.append(s);f.append($("<label>").text(i.Keys.PasswordScore+" "+r));u.append(f).append(t);$("#resultCheck").html(u)});hideAlert();hideLoader()},xhr:function(){var n=$.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",progress,!1),n},error:handleAjaxError})}function requestHeaders(){let n=fileDrop.prepareFormData();var t=$("#txtHeadersAsText").val(),i=o;if(n===null&&!t.length){showAlert(i.FileSelectMessage);return}hideAlert();n===null&&(n=new FormData,t=t.replace(/^\s*[\r\n]/gm,""),console.log(t),n.append("txtHeaders",t));let r=o.APIBasePath+"AsposeEmailHeaders/AnalyzeEmailFiles?skipLocal=true";showLoader();$.ajax({method:"POST",url:r,data:n,processData:!1,contentType:!1,cache:!1,timeout:12e5,success:n=>{hideLoader(),$.headers(n)},xhr:function(){var n=$.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",progress,!1),n},error:handleAjaxError})}function requestAnnotation(){let n=fileDrop.prepareFormData();if(n!==null){let t=o.APIBasePath+"AsposeEmailAnnotation/Remove";request(t,n)}}function requestConversion(){let n=fileDrop.prepareFormData();if(n!==null){let t=o.APIBasePath+"AsposeEmailConversion/Convert?outputType="+$("#saveAs").val();request(t,n)}}function requestMetadata(n){let t=o.APIBasePath+"AsposeEmailMetadata/properties";$.ajax({method:"POST",url:t,data:JSON.stringify(n),processData:!1,contentType:!1,cache:!1,timeout:12e5,success:t=>{$.metadata(t,n.id,n.FileName)},error:handleAjaxError})}function handleAjaxError(n){if(n.data!==undefined&&n.data.Status!==undefined)lastErrorInfo.folderId=n.data.FolderName,lastErrorInfo.error=n.data.Status,showAlert(n.data.Status),showReportWindow(n.data.Status);else{let t="Error "+n.status+": "+n.statusText;if(n.readyState==4){t="Error with HTTP protocol. The file is too big for this operation.";showAlert(t);return}if(n.readyState==0){if(n.statusText==="timeout"){t="Request timeout, connection refused.";showAlert(t);return}if(n.statusText==="error"){t="Network error, connection refused. Please check your internet.";showAlert(t);return}}lastErrorInfo.folderId=n.FolderName;lastErrorInfo.error=t;showAlert(t);showReportWindow(t)}}function requestRedaction(){if(validateSearch()){let n=fileDrop.prepareFormData();if(n!==null){let t=o.APIBasePath+"AsposeEmailRedaction/Redact?outputType="+$("#saveAs").val()+"&searchQuery="+encodeURI($("#searchQuery").val())+"&replaceText="+encodeURI($("#replaceText").val())+"&caseSensitive="+$("#caseSensitive").prop("checked")+"&text="+$("#text").prop("checked")+"&comments="+$("#comments").prop("checked")+"&metadata="+$("#metadata").prop("checked");request(t,n)}}}function validateSearch(){return $("#searchQuery").val().length?!0:(showAlert(o.validationSearchMessage),!1)}function requestSearch(){if(validateSearch()){let n=fileDrop.prepareFormData();if(n!==null){let t=o.APIBasePath+"AsposeEmailSearch/Search?query="+encodeURI($("#searchQuery").val());request(t,n)}}}function validateUnlock(){return $("#passw").val().length?!0:(showAlert(o.validationMessage),!1)}function validateComparison(){return fileDrop.droppedFiles.length===1&&fileDrop.droppedFiles.length===1?!0:(showAlert(o.FileSelectMessage),!1)}function requestComparison(){if(validateComparison()){let n=fileDrop.prepareFormData();if(n!==null){let t=fileDrop2.prepareFormData();if(t!==null){for(var i of t.entries())n.append(i[0],i[1]);let r=o.APIBasePath+"AsposeEmailComparison/Compare";request(r,n)}}}}function requestViewer(n){fileDrop.reset();var t=generateViewerLink(n);openIframe(t,o.AppRoute,"/email/view")}function requestEditor(n){fileDrop.reset();var t=generateEditorLink(n);openIframe(t,o.AppRoute,"/email/edit")}function prepareDownloadUrl(){o.AppDownloadURL=o.AppURL;var n=o.AppDownloadURL.indexOf(":");n>0&&(o.AppDownloadURL=(n>0?o.AppDownloadURL.substring(n+3):o.AppURL)+"/download");n=o.AppDownloadURL.indexOf("/");o.AppDownloadURL=o.AppDownloadURL.substring(n)}function checkReturnFromViewer(){var i=window.location.search,n,t;i.length>0&&(o.ReturnFromViewer=!0,n={StatusCode:200,FolderName:$.QueryString.id,FileName:$.QueryString.FileName,FileProcessingErrorCode:0},t=window.location.href.split("?")[0],window.history.pushState({},document.title,t),o.UploadAndRedirect||workSuccess(n))}function sendFeedbackExtended(){var n=$("#feedbackBody").val();n&&!n.match(/^.s+$/)&&($("#feedbackModal").modal("hide"),sendFeedback(n))}function otherAppClick(n,t=false){if("ga"in window)try{var i=window.ga.getAll()[0];i!==undefined&&i.send("event",{eventCategory:"Other App Click"+(t?" Left":""),eventAction:n})}catch(r){}}function showReportWindow(n){$("#reportErrorText").text(n);$("#reportWindow").removeClass("hidden");$("#reportWindow").animate({opacity:1,transition:"opacity 0.3s ease-out",top:"50%"},300);showDarkMask()}function showReportSentWindow(n,t){closeReportWindow();$("#linkToForums").attr("href",n);$("#reportSuccessLabel").text(t);$("#reportSentWindow").removeClass("hidden");$("#reportSentWindow").animate({opacity:1,transition:"opacity 0.3s ease-out",top:"50%"},300)}function closeReportWindow(){$("#reportWindow").animate({opacity:0,transition:"opacity 0.3s ease-out",top:"60%"},300,"linear",function(){$("#reportWindow").addClass("hidden")})}function closeReportSentWindow(){$("#reportSentWindow").animate({opacity:0,transition:"opacity 0.3s ease-out",top:"60%"},300,"linear",function(){$("#reportSentWindow").addClass("hidden")})}function showDarkMask(){$("#reportWindowMask").removeClass("hidden");$("#reportWindowMask").animate({opacity:.8,transition:"opacity 0.3s ease-out"},300)}function removeDarkMask(){$("#reportWindowMask").animate({opacity:0,transition:"opacity 0.3s ease-out"},300,"linear",function(){$("#reportWindowMask").addClass("hidden")})}function trySendReport(){let n=$("#feedbackEmail").val(),t=$("#privateReportCheckBox").val()==="on",i={folderId:lastErrorInfo.folderId,errorText:lastErrorInfo.error,appname:o.AppName,email:n,isPrivate:t},r=o.APIBasePath+"Common/sendErrorReport";$.ajax({method:"POST",url:r,data:JSON.stringify(i),contentType:"application/json",cache:!1,timeout:3e4,success:n=>{showMessage("The report was successfully sent"),showReportSentWindow(n.link,n.message)},error:n=>{n.data!==undefined&&n.data.Status!==undefined?showAlert(n.data.Status):showAlert("Error "+n.status+": "+n.statusText)}})}const VIEWABLE_EXTENSIONS=["MSG","EML","MBOX","OST","PST"];var fileDrop={},fileDrop2={},lastErrorInfo={};$.extend($.expr[":"],{isEmpty:function(n){return n.value===""}}),function(n){n.fn.inputFilter=function(n){return this.on("input keydown keyup mousedown mouseup select contextmenu drop",function(){n(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""})}}(jQuery),function(n){n.QueryString=function(n){let t={};for(let i=0;i<n.length;++i){let r=n[i].split("=",2);r.length===2&&(t[r[0]]=decodeURIComponent(r[1].replace(/\+/g," ")))}return t}(window.location.search.substr(1).split("&"))}(jQuery);$(document).ready(function(){var n,t;if(prepareDownloadUrl(),fileDrop=$("form#UploadFile").filedrop(Object.assign({showAlert:showAlert,hideAlert:hideAlert,showLoader:showLoader,progress:progress},o)),o.AppName==="Comparison"&&(fileDrop2=$("form#UploadFile").filedrop(Object.assign({showAlert:showAlert,hideAlert:hideAlert,showLoader:showLoader,progress:progress},o))),$("#sendReportButton").click(trySendReport),$("#closeReportSuccessButton").click(function(){closeReportSentWindow();removeDarkMask()}),$("#closeReportButton").click(function(){closeReportWindow();removeDarkMask()}),window.onpopstate=function(){$("div#iframe-wrap").length>0&&closeIframe()},!o.UploadAndRedirect||o.NeedsProcessButton)$("#uploadButton").on("click",o.Method);$("#bookmarkModal").on("show.bs.modal",function(){$("#bookmarkModal").css("display","flex");$("#bookmarkModal").on("keydown",function(n){(n.metaKey||n.ctrlKey)&&String.fromCharCode(n.which).toLowerCase()==="d"&&$("#bookmarkModal").modal("hide")})});$("#bookmarkModal").on("hidden.bs.modal",function(){$("#bookmarkModal").off("keydown")});$("#sendEmailButton").on("click",function(){$("#sendEmailModal").modal({keyboard:!0})});$("#sendEmailModal").on("show.bs.modal",function(){$("#sendEmailModal").css("display","flex")});$("#sendEmailModal").on("shown.bs.modal",function(){$("#EmailToInput").focus()});$("#feedbackModal").on("show.bs.modal",function(){$("#feedbackModal").css("display","flex")});$("#feedbackModal").on("shown.bs.modal",function(){$("#feedbackBody").focus()});$("#sendFeedbackBtn").on("click",sendFeedback);if(n=o.InvalidResourceKeys,n&&n.length)for(t=0;t<n.length;t++)console.warn("Resource Key not found: "+n[t])});