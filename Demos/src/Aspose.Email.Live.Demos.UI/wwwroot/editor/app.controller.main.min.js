angular.module("AsposeEditorApp").controller("EditorController",function(n,t,i){function s(n){return n.substring(n.lastIndexOf(".")+1,n.length)||n}function e(t,u,f,e){let l=h(u),s=o++,c={Index:s,Name:t,WasAdded:e,NeedRemove:!1,Extension:u};return r[s]=c,$("#attachments").append(i('<div class="col-md-4 media-item"><div class="media-content"><figure><img class="img-fluid" src="'+l+'"/><\/figure><div class="media-body col-md-2"><h5 class="mt-1 font-weight-bold">'+f+"<\/h5>"+t+'<\/div><button type="button" class="close" aria-label="Close" ng-click="RemoveAttachment($event, '+s+",'"+t+'\')">\t<span aria-hidden="true">&times;<\/span><\/button><\/div><\/div>')(n)),c}function h(n){switch(n){case".eml":return"/img/icon-eml.png";case".msg":return"/img/icon-msg.png";case".mbox":return"/img/icon-pst.png";case".ost":return"/img/icon-ost.png";case".pst":return"/img/icon-pst.png";case".pdf":return"/img/icon-pdf.png";case".html":return"/img/icon-html.png";case".pptx":return"/img/icon-pptx.png";case".mht":return"/img/icon-mht.png";case".ppt":return"/img/icon-ppt.png";case".odt":return"/img/icon-doc.png";case".ott":return"/img/icon-doc.png";case".dotx":return"/img/icon-doc.png";case".dotm":return"/img/icon-doc.png";case".docx":return"/img/icon-doc.png";case".docm":return"/img/icon-doc.png";case".doc":return"/img/icon-doc.png";case".rtf":return"/img/icon-doc.png";case".txt":return"/img/icon-text.png";case".xls":return"/img/icon-xls.png";case".jpg":return"/img/icon-jpg.png";case".jpeg":return"/img/icon-jpg.png";case".png":return"/img/icon-image.png";case".tiff":return"/img/icon-tiff.png";case".bmp":return"/img/icon-bmp.png";case".tga":return"/img/icon-image.png";case".svg":return"/img/icon-svg.png";case".ico":return"/img/icon-image.png";default:return"/img/icon-doc.png"}}var r={},o=0,u=!1,f=!1;n.trum=null;n.t=null;n.loading=!1;n.allowPreview=!1;n.isPreview=!1;n.refresh=!0;n.pageIndex=1;n.pageNumber=1;window.history.pushState(null,null,"/email/editor");n.OpenFileInput=function(){$("#file-input").trigger("click")};n.HandleFileInput=function(n){if(n.files)for(var t=0;t<n.files.length;t++){let i=n.files[t],u=e(i.name,s(i.name),"Document",!0),r=new FileReader;r.onload=function(){u.SourceBase64=btoa(String.fromCharCode.apply(null,new Uint8Array(this.result)))};r.readAsArrayBuffer(i)}};n.RemoveAttachment=function(n,t,i){let u=confirm('Remove this attachment "'+i+'"?');if(u){let i=r[t];if(i.NeedRemove)return;i.WasAdded?delete r[t]:i.NeedRemove=!0;$(n.currentTarget).parent().parent().remove()}};n.Init=function(){if(f===!1){f=!0;n.trum=$("#editor");n.trum.trumbowyg({autogrow:!0,fixedBtnPane:!0,minimalLinks:!0,urlProtocol:!0,prefix:"editoraspose-",svgPath:"/editor/trumbowyg/icons.svg",btnsDef:{image:{dropdown:["insertImage","base64"],ico:"insertImage"},togglePreview:{fn:function(){n.TogglePreview()},tag:"toggle_preview",title:"Toggle editor/preview mode",text:"Preview",hasIcon:!1,isSupported:function(){return n.allowPreview}}},btns:[["historyUndo","historyRedo"],["formatting"],["fontfamily"],["fontsize"],["strong","em","underline"],["foreColor","backColor"],["superscript","subscript"],["link"],["image"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["fullscreen"]],plugins:{fontfamily:{fontList:[{name:"Arial",family:"Arial, Helvetica, sans-serif"},{name:"Arial Black",family:"'Arial Black', Gadget, sans-serif"},{name:"Comic Sans",family:"'Comic Sans MS', Textile, cursive, sans-serif"},{name:"Courier New",family:"'Courier New', Courier, monospace"},{name:"Georgia",family:"Georgia, serif"},{name:"Impact",family:"Impact, Charcoal, sans-serif"},{name:"Lucida Console",family:"'Lucida Console', Monaco, monospace"},{name:"Lucida Sans",family:"'Lucida Sans Uncide', 'Lucida Grande', sans-serif"},{name:"Palatino",family:"'Palatino Linotype', 'Book Antiqua', Palatino, serif"},{name:"Tahoma",family:"Tahoma, Geneva, sans-serif"},{name:"Times New Roman",family:"'Times New Roman', Times, serif"},{name:"Trebuchet",family:"'Trebuchet MS', Helvetica, sans-serif"},{name:"Verdana",family:"Verdana, Geneva, sans-serif"}]},fontsize:{sizeList:["9","14","18","22","30"],allowCustomSize:!0}}});n.trum.trumbowyg("html","");n.t=n.trum.data("trumbowyg");n.GetEditorHtml()}};n.GetEditorHtml=function(){if(folderName===""&&fileName===""){u=!0;n.trum.trumbowyg("html",">>> Place your content here <<<");$("#page-loading").fadeOut(600);$("#htmlloader").hide();return}var i={folderName:folderName,fileName:fileName};t({method:"POST",url:asposeEditorAPI+"GetDocumentData",params:i,responseType:"application/json"}).then(function(t){let i=t.data;if(n.trum.trumbowyg("html",i.Html),i.Attachments)for(var r=0;r<i.Attachments.length;r++){let n=i.Attachments[r];e(n.Name,n.Extension,n.Type,!1)}},function(t){n.ShowError(t.data);n.trum.trumbowyg("html","")}).finally(function(){$("#page-loading").fadeOut(600);$("#htmlloader").hide()})};n.TogglePreview=function(){n.isPreview=!n.isPreview;n.isPreview?(document.activeElement.blur(),n.DoRefresh(),$("#preview_pane").removeClass("hidden"),$("#editor_pane").addClass("hidden")):($("#editor_pane").removeClass("hidden"),$("#preview_pane").addClass("hidden"))};n.DoRefresh=function(){n.refresh=!0;n.GetPreviewData()};n.GoNext=function(){n.refresh=!1;n.pageIndex<n.pageNumber&&(n.pageIndex+=1);n.GetPreviewData()};n.GoPrev=function(){n.refresh=!1;n.pageIndex>1&&(n.pageIndex-=1);n.GetPreviewData()};n.GoFirst=function(){n.refresh=!1;n.pageIndex=1;n.GetPreviewData()};n.GoLast=function(){n.refresh=!1;n.pageIndex=n.pageNumber;n.GetPreviewData()};n.SetPreviewPageImg=function(t){var i="data:image/jpeg;base64,"+t.Text;n.pageNumber=t.FileCount;$("#preview_container > img")[0].src=i;$("#page_count").text(n.pageIndex+" of "+n.pageNumber)};n.GetPreviewData=function(){$("#page-loading").show();$("#loader").show();var i=n.trum.trumbowyg("html");t({method:"POST",url:asposeEditorAPI+"GetPreviewData",data:{htmldata:i,folderName:folderName,fileName:fileName,refresh:n.refresh,pageIndex:n.pageIndex},responseType:"application/json"}).then(function(t){var i=t.data;n.SetPreviewPageImg(i)},function(t){n.ShowError(t.data)}).finally(function(){$("#page-loading").fadeOut(600)})};n.Download=function(i){$("#page-loading").show();$("#loader").show();t({method:"POST",url:asposeEditorAPI+"UpdateContentsWithAttachments",data:{createNewFile:u,fileName:fileName,folderName:folderName,htmldata:n.trum.trumbowyg("html"),outputType:i,attachmentsData:r},responseType:"application/json"}).then(function(t){var i=t.data,r;i.StatusCode===200?(r=fileDownloadLink+"/"+i.FolderName+"?file="+i.FileName,window.lastDownloadLink=r,window.location=r):n.ShowError(i.Status)},function(t){n.ShowError(t.data)}).finally(function(){$("#page-loading").fadeOut(600)})};n.ShowError=function(n){$("#alert > p")[0].innerText=n;$("#alert").show()};n.Init()});